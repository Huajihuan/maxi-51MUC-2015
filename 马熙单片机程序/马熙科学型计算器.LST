C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷
OBJECT MODULE PLACED IN ÂíÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE ÂíÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "reg52.h"
   2          #include <stdlib.h>        //°üº¬atof(),×Ö·û´®->ÊµÊı
   3          #include <stdio.h>         //°üº¬sprintf(),ÊµÊı->×Ö·û´®
   4          #include <string.h>        //°üº¬strcpy(),×Ö·û´®¸´ÖÆ
   5          #include <math.h>                  //ÊıÑ§º¯ÊıÍ·ÎÄ¼ş
   6          #define uchar unsigned char
   7          #define uint unsigned int
   8          uchar num;
   9          /*************lcd****************/
  10          sbit lcdrs=P2^6; //LCD¿ØÖÆ½Å
  11          sbit lcdrw=P2^5;
  12          sbit lcden=P2^7;
  13          bit  form;            //lcdÏÔÊ¾·½Ê½ÇĞ»»
  14          uchar idata state;         //lcd×´Ì¬×Ö´æ´¢
  15          /************¼ÆËãÆ÷*************/
  16          sbit reset=P2^0;           //¼ÆËãÆ÷¸´Î»
  17          sbit back=P2^1;            //³·ÏúÉÏ´Î¼üÈë¼ü
  18          sbit save=P2^2;            //´æ´¢¼ü£¬´æ´¢ÓĞÉÏ´ÎµÄ½á¹ûºÍÁíÍâÄ³´Î¼ÆËãÖµ
  19          bit eqsign;          //°´µÈºÅ±êÖ¾
  20          bit press;           //¼ü°´±êÖ¾
  21          bit savesign;        //¿É´æ´¢½á¹û±êÖ¾
  22          bit sc;                    //¸´ÓÃ±êÖ¾
  23          uchar idata process[30],proc; //¼ÇÒä¼ÆËã¹ı³Ì£¬ÒÔ±ã´íÎó»Ö¸´ºÍ³·ÏúÊäÈë
  24          uchar idata continu=0;        //Á¬Ğø¼ÆËãÔËËã·ûºÅ´æ´¢
  25          uchar idata pai[2][2];        //¦Ğ Ç°ÓĞÊı¾İ±êÖ¾
  26          uchar idata ferror;        //¼ÆËã¼ì´í±êÖ¾
  27          uchar idata ywei;                  //ÆÁÄ»ÒÆÎ»
  28          uchar idata count=0;       //ÊäÈë¼ÆÊı
  29          uchar idata count_num=0;   //×éºÅ¼ÆÊı
  30          uchar idata result[15];    //¼ÆËã½á¹ûÁ¢´æ£¬save
  31          uchar idata saveresult[15];//´æ´¢½á¹ûÊı×é, sc+save
  32          uchar idata jieguo[15];    //½á¹û×Ö·û´®
  33          uchar idata bdate[2][14];  //´ı¼ÆËã×Ö·û´®¶şÎ¬×é
  34          uchar idata on_symbol;     //ÔËËã·ûºÅ
  35          uchar idata fsym[2];       //º¯ÊıÇ°·ûºÅ
  36          uchar idata ssym[2];       //´æ´¢×éÇ°·ûºÅ
  37          uchar idata bfun[2];       //¼ÆËãÖµµ÷ÓÃº¯ÊıÑ¡Ôñ
  38          uchar idata futojiao[2];   //·ù¶È to ½Ç¶È±ä»»
  39          double idata date[2];      //¼ÆËãÖµË«¾«¶È±äÁ¿×é
  40          double idata resultdate;   //Ë«¾«¶È½á¹ûÖµ
  41          sbit sfyong=P2^3;           //¼ÆËãÆ÷¸´ÓÃ¼ü
  42          /******************º¯ÊıÉùÃ÷**********************/
  43          
  44          /***************ÑÓÊ±******************/
  45          void delay(uchar z);
  46          /*************lcdĞ´ÃüÁî***************/
  47          void write_com(uchar com);
  48          /*************lcdĞ´Êı¾İ***************/
  49          void write_date(uchar date);
  50          /*************lcd¶Á×´Ì¬***************/
  51          void read_date(void);
  52          /*************lcdĞ´×Ö·û´®*************/
  53          void write_str(uchar *str);
  54          /************Òº¾§³õÊ¼»¯***************/
  55          void init(void );
C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 2   

  56          
  57          /**********ÒÆÆÁ*******************/
  58          void write();
  59          /**********¸´ÓÃÌáÊ¾¿ª¹Ø***************/
  60          void shift(void);
  61          /**************¼üÅÌÉ¨Ãè***************/
  62          uchar keyscan(void);
  63          /*************¼ÆËãÆ÷¸´Î»**************/
  64          void fuwei();
  65          /************error´¦Àí****************/
  66          void callerror(void);
  67          /***************³·Ïú¼üÈë**************/
  68          void huifu(void);
  69          /**********º¯Êı×éÇ°·ûºÅ´¦Àí***********/
  70          uchar funqian(void);
  71          /************ÔËËã·ûÔ¤´¦Àí*************/
  72          void  cullars(uchar);
  73          /***********Êä³ö´æ´¢Êı¾İÔ¤´¦Àí********/
  74          char  memory(void);
  75          /***********°´¼ü¹¦ÄÜÖ÷´¦Àí************/
  76          void process_date(uchar press_date);
  77          /***********°´¼ü¹¦ÄÜ×Ó´¦Àí************/
  78          void calculator(uchar press_date);
  79          /************************************************/
  80          void write()
  81          {
  82   1         for(num=0;num<16;num++)
  83   1            {
  84   2             write_com(0x18);
  85   2             delay(200);
  86   2            }
  87   1      }
  88          /*************LCD³ÌĞò****************/
  89          /**************ÑÓÊ±******************/
  90          void delay(uchar z)                        
  91          {
  92   1            uchar  x,y;
  93   1            for(x=z;x>0;x--)
  94   1            for(y=100;y>0;y--);
  95   1      }
  96          
  97          /**************Ğ´ÃüÁî*****************/
  98          void write_com(uchar com)
  99          {
 100   1            lcdrs=0;
 101   1            lcdrw=0;
 102   1            lcden=0;
 103   1            P0=com;
 104   1            delay(5);
 105   1            lcden=1;
 106   1            delay(5);
 107   1            lcden=0;
 108   1      }
 109          /*************Ğ´Êı¾İ******************/
 110          void write_date(uchar date)
 111          {
 112   1            lcdrs=1;
 113   1            lcdrw=0;
 114   1            lcden=0;
 115   1            P0=date;
 116   1            delay(5);
 117   1            lcden=1;
C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 3   

 118   1            delay(5);
 119   1            lcden=0;
 120   1      }
 121          /*************¶ÁAC µØÖ·*****************/
 122          void read_date(void)
 123          {
 124   1            lcdrs=0;
 125   1            lcdrw=1;
 126   1                delay(5);
 127   1                P0=0xff;
 128   1            lcden=1;
 129   1            delay(5);
 130   1            state=P0;
 131   1            delay(5);
 132   1            lcden=0;delay(5);
 133   1                state=state&127;
 134   1      }
 135          /*************Ğ´×Ö·û´®******************/
 136          void write_str(uchar *str)
 137          {
 138   1            uchar idata i;
 139   1            for(i=0;str[i]!='\0';i++)
 140   1               write_date(str[i]);
 141   1      }
 142          /***********Òº¾§³õÊ¼»¯***************/
 143          void init(void )
 144          {
 145   1            write_com(0x38);       //Ä£Ê½£º8Î»Êı¾İ£¬Á½ĞĞ£¬5*7×ÖÌå
 146   1            write_com(0x0c);       //¿ªÏÔÊ¾£¬ÎŞ¹â±ê
 147   1            write_com(0x06);       //Ïò×óÔöÁ¿ÒÆ¶¯
 148   1            write_com(0x01);       //ÇåÆÁ
 149   1      }
 150          
 151          /**********¸´ÓÃÌáÊ¾¿ª¹Ø***************/
 152          void shift(void)
 153          {
 154   1         if(sc==1)
 155   1         {
 156   2                read_date();                  //¶Á×´Ì¬
 157   2            write_com(0xc0);      //ÏÔÊ¾¸´ÓÃÌáÊ¾£¬×óÏÂ½Ç's'
 158   2                write_date('s');
 159   2                write_com(state+0x80);//¹â±ê»¹»ØÔ­À´Î»ÖÃ
 160   2         }
 161   1        else
 162   1        {
 163   2            read_date();
 164   2            write_com(0xc0);     //¹Ø±Õ¸´ÓÃÌáÊ¾
 165   2                write_date(' ');
 166   2                write_com(state+0x80);
 167   2        }
 168   1        return;
 169   1      }
 170          
 171          /**************¼üÅÌÉ¨Ãè*************/
 172          uchar keyscan(void)          //°´ĞĞÉ¨Ãè£¬ÓĞ¼ü°´ÏÂÔò·µ»Ø¼ü·ûºÅ£¬·ñÔò·µ»Ønull
 173          {     uchar idata key0,key1,keyment=0;
 174   1            P3=0XFe;                                     //ĞĞ1
 175   1            key0=P3;
 176   1            key0=key0&0xf0;
 177   1            key1=key0;
 178   1            if(key0!=0xf0)
 179   1            {
C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 4   

 180   2                 delay(5);               //¼ü¶¶¶¯´¦Àí
 181   2                 P3=0XFe;
 182   2                 key0=P3;
 183   2                 key0=key0&0xf0;
 184   2                 if(key0==key1)
 185   2                 {
 186   3                      switch(key0)
 187   3                      {
 188   4                        case 0xe0:keyment='7';break;
 189   4                        case 0xd0:keyment='8';break;
 190   4                        case 0xb0:keyment='9';break;
 191   4                        case 0x70:keyment=0xfd;break;  //0xfd³ıºÅÔÚ1602Òº¾§ÖĞµÄ´úÂë
 192   4                      }
 193   3                      while(key0!=0xf0)  //¼üÊÍ·Å´¦Àí
 194   3                      {
 195   4                        key0=P3;
 196   4                        key0=key0&0xf0;
 197   4                      }
 198   3                      press=1;                   //¼ü°´±êÖ¾ÖÃ1
 199   3                      return(keyment);
 200   3                 }
 201   2            }
 202   1            P3=0XFd;                                    //ĞĞ2
 203   1            key0=P3;
 204   1            key0=key0&0xf0;
 205   1            key1=key0;
 206   1            if(key0!=0xf0)
 207   1            {
 208   2                 delay(5);
 209   2                 P3=0XFd;
 210   2                 key0=P3;
 211   2                 key0=key0&0xf0;
 212   2                 if(key0==key1)
 213   2                 {
 214   3                     switch(key0)
 215   3                     {
 216   4                        case 0xe0:keyment='4';break;
 217   4                        case 0xd0:keyment='5';break;
 218   4                        case 0xb0:keyment='6';break;
 219   4                        case 0x70:keyment='*';break;
 220   4                     }
 221   3                     while(key0!=0xf0)
 222   3                     {
 223   4                        key0=P3;
 224   4                        key0=key0&0xf0;
 225   4                     }
 226   3                     press=1;
 227   3                     return(keyment);
 228   3                 }
 229   2            }
 230   1            P3=0XFb;                                           //ĞĞ3
 231   1            key0=P3;
 232   1            key0=key0&0xf0;
 233   1            key1=key0;
 234   1            if(key0!=0xf0)
 235   1            {
 236   2                 delay(5);
 237   2                 P3=0XFb;
 238   2                 key0=P3;
 239   2                 key0=key0&0xf0;
 240   2                 if(key0==key1)
 241   2                 {
C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 5   

 242   3                     switch(key0)
 243   3                     {
 244   4                         case 0xe0:keyment='1';break;
 245   4                         case 0xd0:keyment='2';break;
 246   4                         case 0xb0:keyment='3';break;
 247   4                         case 0x70:keyment='-';break;
 248   4                     }
 249   3                     while(key0!=0xf0)
 250   3                     {
 251   4                         key0=P3;
 252   4                         key0=key0&0xf0;
 253   4                     }
 254   3                     press=1;
 255   3                     return(keyment) ;
 256   3                 }
 257   2            }
 258   1            P3=0XF7;                                    //ĞĞ4
 259   1            key0=P3;
 260   1            key0=key0&0xf0;
 261   1            key1=key0;
 262   1            if(key0!=0xf0)
 263   1            {
 264   2                 delay(5);
 265   2                 P3=0XF7;
 266   2                 key0=P3;
 267   2                 key0=key0&0xf0;
 268   2                 if(key0==key1)
 269   2                 {
 270   3                     switch(key0)
 271   3                     {
 272   4                       case 0xe0:keyment='.';break;
 273   4                       case 0xd0:keyment='0';break;
 274   4                       case 0xb0:keyment='=';break;
 275   4                       case 0x70:keyment='+';break;
 276   4                     }
 277   3                     while(key0!=0xf0)
 278   3                     {
 279   4                       key0=P3;
 280   4                       key0=key0&0xf0;
 281   4                     }
 282   3                     press=1;
 283   3                     return(keyment);
 284   3                 }
 285   2           }
 286   1           if(reset==0)          //¸´Î»¼ü
 287   1           {
 288   2                 keyment=' ';
 289   2                 press=1;
 290   2                 while(reset==0);//¼üÊÍ·Å
 291   2                 return(keyment);
 292   2               }
 293   1           else if(back==0)          //³·ÏúÇ°´ÎÊäÈë
 294   1           {
 295   2                         keyment='c';
 296   2                 press=1;
 297   2                 while(back==0);
 298   2                 shift();
 299   2                 return(keyment);
 300   2               }
 301   1           else  if(save==0)             //´¢´æÊı¾İ¼ü
 302   1           {  delay(5);
 303   2                  if(save==0)
C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 6   

 304   2                  { if(sc==0)    //Êä³öÇ°´Î¼ÆËã½á¹û¼ü
 305   3                     {
 306   4                            keyment='m';
 307   4                    press=1;
 308   4                    while(save==0);
 309   4                    return(keyment);
 310   4                         }
 311   3                         else                    //¸üĞÂ´æ´¢µÄÊı¾İ»òÊä³ö´æ´¢µÄÊı¾İ
 312   3                         {
 313   4                    keyment='n';
 314   4                    press=1;
 315   4                                sc=0;
 316   4                                shift();
 317   4                    while(save==0);
 318   4                    return(keyment);
 319   4                         }
 320   3                      }
 321   2           }
 322   1               else if(sfyong==0)                //¼ÆËãÆ÷Ê±Îª¸´ÓÃ¹¦ÄÜ¼ü
 323   1           {   delay(5);
 324   2                   if(sfyong==0)
 325   2                       {  keyment='h';
 326   3                  press=1;
 327   3                  while(sfyong==0);
 328   3                  return(keyment);
 329   3                       }return(0);
 330   2           }else return(0);      //ÎŞ¼ü°´ÏÂ·µ»Ønull
 331   1      }
 332          
 333          /**************¼ÆËãÆ÷¸´Î»****************/
 334          void fuwei()
 335          {   uchar idata j,i;
 336   1          write_com(0x0f);        //lcdÉèÖÃ
 337   1          write_com(0x01);
 338   1          write_com(0x80);
 339   1          resultdate=0;
 340   1          for(i=0;i<2;i++)
 341   1              { date[i]=0;bfun[i]=0;pai[0][i]=0;pai[1][i]=0;fsym[i]=0;futojiao[i]=0; //¸÷±êÖ¾ÖÃ0
 342   2                for(j=0;j<14;j++)             //×Ö·ûÊı×é³õÊ¼»¯
 343   2            {
 344   3              bdate[i][j]='\0';
 345   3            }
 346   2              }
 347   1          count=0;                            //¸÷±êÖ¾ÖÃ0
 348   1          count_num=0;
 349   1              proc=0;
 350   1          ferror=0;
 351   1          eqsign=0;
 352   1              sc=0;
 353   1              savesign=0;
 354   1              ywei=0;
 355   1              press=0;
 356   1              on_symbol=0;
 357   1      }
 358          /**************error´¦Àí******************/
 359          void callerror(void)
 360          {   uchar idata i;
 361   1          write_com(0x01);
 362   1          write_com(0x80);
 363   1          write_str("     error!     ");
 364   1          for(i=0;i<200;i++)delay(25); //³ÖĞøÏÔÊ¾ 1s
 365   1      }
C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 7   

 366          /*************º¯Êı×éÇ°·ûºÅ´¦Àí************/
 367          uchar funqian(void)        //ÊäÈëº¯ÊıÇ°¼ì²éÊÇ·ñ´íÎó
 368          {  if((bdate[ferror][0]=='+'||bdate[ferror][0]=='-')&&count==1)
 369   1         {
 370   2                      fsym[ferror]=bdate[ferror][0];
 371   2                      bdate[ferror][0]='\0';
 372   2                      bdate[ferror][1]='\0';
 373   2                      count=0;
 374   2         }
 375   1         if(bdate[ferror][0]!='\0'||bfun[ferror]!=0)//´íÎóÊäÈë·½Ê½´¦Àí
 376   1         {    callerror();
 377   2              huifu();
 378   2                      return(1);
 379   2         }
 380   1         return(0);
 381   1      }
 382          /****************³·ÏúÉÏ´ÎÊäÈë****************/
 383          void huifu(void)
 384          {
 385   1           uchar j,pro;          //pro±äÁ¿ÓÃÓÚ»Ö¸´proc
 386   1           if(proc!=0)proc--;
 387   1               pro=proc;
 388   1               fuwei();
 389   1               proc=pro;
 390   1               for(j=0;j<proc;j++)calculator(process[j]);     //ÒÀ´Î»Ö¸´Ö®Ç°µÄ²Ù×÷
 391   1               return;
 392   1      }
 393          /*****************ÔËËã·ûÔ¤´¦Àí*****************/
 394          void  cullars(uchar csym)
 395          {       read_date();               //¿´µÚ¶ş×éÊÇ·ñÓĞÊäÈë
 396   1              ferror++;              //¼ì´í±êÖ¾+1
 397   1              continu=csym;              //´æ´¢ÔËËã·ûºÅ
 398   1              if(ferror==2&&state<0x43){callerror();huifu();return;}// µÚ¶ş×éÎŞÊäÈëÇÒferror=2£¬´íÎó
 399   1              if(ferror==2&&state>0x42)       //µÚ¶ş×éÓĞÊäÈëÇÒferror=2£¬Ôò½øĞĞÁ¬Ğø¼ÆËã
 400   1              {
 401   2                 press=1;                                     //Ä£Äâ°´¼ü¡®=¡¯ºÍ¡®M+¡¯£»½«±¾´ÎµÄ¼ÆËã½á¹û×÷ÎªÏÂÒ»´Î¼ÆËãµÄµÚÒ»×é
 402   2                 process_date('=');
 403   2                 press=1;
 404   2                 process_date('m');
 405   2                 ferror=1;                            //»Ö¸´ÏÖ³¡£¬±ÜÃâ±ä»¯
 406   2                 if(continu=='^'||continu=='%'){process[proc]='h';
 407   3                      proc++;process[proc]=continu;proc++;}
 408   2                 else{process[proc]=continu;proc++;}    //»Ö¸´Á¬Ğø¼ÆËã¹ı³Ì
 409   2              }
 410   1              if(continu=='%'){write_str(" f");}else write_date(' ');
 411   1              write_date(continu);//½«ÓÃÓëÁ¬Ğø¼ÆËãµÄÔËËã·ûºÅÈ¡³ö
 412   1              ywei=0;
 413   1              savesign=0;
 414   1              count_num=1;     //×é±êÖ¾¼Ó1
 415   1              count=0;                 //ÊäÈë¼ÆÊıÇåÁã
 416   1              on_symbol=continu;  //ÔËËã·ûºÅµ÷ÓÃ
 417   1              write_com(0xc2);
 418   1              return;
 419   1      }
 420          /*************Êä³ö´æ´¢Êı¾İÔ¤´¦Àí************/
 421          char  memory(void)
 422          {       if((bdate[count_num][0]=='+'||bdate[count_num][0]=='-')&&count==1)//·ûºÅ´¦Àí
 423   1          {
 424   2                      ssym[count_num]=bdate[count_num][0];
 425   2                      bdate[count_num][0]='\0';
 426   2                      bdate[count_num][1]='\0';
 427   2                      count=0;
C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 8   

 428   2              }
 429   1          if(bdate[count_num][0]!='\0'){callerror();huifu();return(1);}       //´íÎóÊäÈë·½Ê½´¦Àí
 430   1              return(0);
 431   1      }
 432          /**************°´¼ü¹¦ÄÜÖ÷´¦Àí****************/
 433          void process_date(uchar press_date)
 434          {
 435   1           if(form==0){write_com(0x0f);form=1;}   //ÏÔÊ¾·½Ê½ÇĞ»» ¹â±êÉÁË¸
 436   1           if(eqsign==1&&press==1)fuwei();            //¸´Î»ÔÙ´Î¼ÆËã£¬¼ÇÒä¹ı³ÌÇåÁã
 437   1               press=0;
 438   1               if(press_date=='c'){huifu();press_date=0;}
 439   1               if(press_date==0)return;               //ÎŞ°´¼ü
 440   1               process[proc]=press_date;
 441   1               proc++;
 442   1               calculator(press_date);
 443   1               return;
 444   1      }
 445          /***************°´¼ü¹¦ÄÜ×Ó´¦Àí***************/
 446          void calculator(uchar press_date)
 447          {
 448   1           uchar idata j=0;
 449   1               /*************************************/
 450   1               if(press_date==('h'))     //¸´ÓÃ¼ü
 451   1               {
 452   2                   sc=~sc;               //°´¼ü¹¦ÄÜÇĞ»»£¬scÎª1Ê±µ÷ÓÃº¯Êı
 453   2                       shift();                  //ÏÔÊ¾Óë¹Ø±Õ¸´ÓÃÌáÊ¾
 454   2               }
 455   1           /*************************************/
 456   1           else if((press_date<='9'&&press_date>='0')||(press_date=='.')) //Êı×Ö¼ü´¦Àí
 457   1           {  savesign=0;                       //²»¿É¸üĞÂ´æ´¢Êı¾İ
 458   2              if(sc==0)                         //ÊÇ·ñÎª¸´ÓÃscÎª0£¬ÊÇÊı×Ö
 459   2              {
 460   3                 if(count<14-ywei)  //Î´µ÷ÓÃº¯ÊıÊ±×î¶àÊäÈë14Î»Êı£¬°üÀ¨Ğ¡Êıµã
 461   3                 {
 462   4                                     write_date(press_date);
 463   4                         bdate[count_num][count]=press_date; //´¢´æ¼üÖµ
 464   4                         count++;
 465   4                 }
 466   3                 else {callerror();huifu();}  //³¬³ö14Î»³ö´í,»Ö¸´
 467   3      
 468   3              }
 469   2              else switch(press_date)   //¸´ÓÃÊ±
 470   2              {             //            ÅÅ´í                        ÖÃº¯Êı±êÖ¾·ûºÅ  ¸´ÓÃÇåÁã         ÒÆÎ»£¬´ËÊ±Êı¾İÖ»ÄÜ(14-ywei)Î»
 471   3                 case '7': j=funqian();if(j==1)return;bfun[ferror]='s';sc=0;shift();ywei=4;write_str("sin ");bre
             -ak; //º¯Êısin
 472   3                 case '8': j=funqian();if(j==1)return;bfun[ferror]='c';sc=0;shift();ywei=4;write_str("cos ");bre
             -ak; //º¯Êıcos
 473   3                 case '9': j=funqian();if(j==1)return;bfun[ferror]='t';sc=0;shift();ywei=4;write_str("tan ");bre
             -ak; //º¯Êıtan
 474   3                         case '4': j=funqian();if(j==1)return;bfun[ferror]='e';sc=0;shift();ywei=4;write_str("exp ");break; //
             -º¯Êıexp
 475   3                         case '5': j=funqian();if(j==1)return;bfun[ferror]='l';sc=0;shift();ywei=3;write_str("ln ");break;  //
             -º¯Êıln
 476   3                         case '6': j=funqian();if(j==1)return;bfun[ferror]='g';sc=0;shift();ywei=3;write_str("Lg ");break;  //
             -º¯ÊıLg
 477   3                         case '1': j=funqian();if(j==1)return;bfun[ferror]='q';sc=0;shift();ywei=5;write_str("sqrt ");break;//
             -º¯Êısqrt
 478   3                         case '0': j=funqian();if(j==1)return;bfun[ferror]='d';sc=0;shift();ywei=4;write_str("dao ");break; //
             -º¯Êıdao(µ¹Êı)
 479   3                         case '.': if(count==0){ pai[count_num][0]=1;count=14-ywei; }          //Ô²ÖÜÂÊ pai´¦Àí          ¦ĞÇ°ÃæÎŞ¼ÓÈ¨
 480   3                                               else{ pai[count_num][1]=1;count=14;}   //  ¦ĞÇ°Ãæ¿ÉÒÔÓĞ¼ÓÈ¨£¬ºóÃæ²»ÄÜ¸úÊı¾İ
 481   3                                               write_date(247);sc=0;shift();break;
C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 9   

 482   3                        /************************2ºÍ3ÊÇË«²ÎÊıº¯Êı µ±ÔËËã·ûÊ¹ÓÃ*************************/
 483   3                         case '2':    //x^y xµÄy´Î·½
 484   3                                               cullars('^');           //µ÷ÓÃÔËËã·ûºÅ´¦Àí³ÌĞò
 485   3                                               sc=0;shift();
 486   3                                               break;
 487   3                         case '3':    //A/BµÄÓàÊı£¨Ë«¾«¶È£©
 488   3                                               cullars('%');           //µ÷ÓÃÔËËã·ûºÅ´¦Àí³ÌĞò
 489   3                                               sc=0;shift();
 490   3                                               break;
 491   3               }
 492   2            }
 493   1             /*************************************************/
 494   1            else if(press_date=='m')       //ÉÏ´Î¼ÆËã½á¹ûÊä³ö
 495   1            {
 496   2                 if(memory()==1)return;                                                 //Êä³ö´æ´¢Êı¾İÔ¤´¦Àí
 497   2                 for(j=0;result[j]!='\0';j++)write_date(result[j]);           //Êä³ö´æ´¢Öµ
 498   2                 strcpy(bdate[count_num],result);
 499   2                         savesign=1;            //´ËÊ±¿ÉÒÔ¸üĞÂsaveresultÖĞ´æ´¢µÄÊı¾İ
 500   2                         count=14;          //count=14ÊÇÈÃ±¾×éÊı¾İÒÑÈ·¶¨
 501   2                }
 502   1            /*************************************************/
 503   1            else if(press_date=='n')       //´æ´¢µÄÊı¾İ¸üĞÂ»òÊä³ö
 504   1            {   if(savesign==1)
 505   2                {  strcpy(saveresult,result);
 506   3                   savesign=0;                                                 //±êÖ¾ÖØĞÂÖÃÁã
 507   3                   write_com(0x01);
 508   3                   write_com(0x80);
 509   3                   write_str("    success!    ");              //´æ´¢³É¹¦ÌáÊ¾
 510   3                   for(j=0;j<200;j++)delay(25);
 511   3                   fuwei();
 512   3                }
 513   2                else
 514   2                {
 515   3                           if(memory()==1)return;                                              //Êä³ö´æ´¢Êı¾İÔ¤´¦Àí
 516   3                   for(j=0;saveresult[j]!='\0';j++)write_date(saveresult[j]);   //Êä³ö´æ´¢Öµ
 517   3                   strcpy(bdate[count_num],saveresult);
 518   3                               count=14;
 519   3                }
 520   2            }
 521   1            /****************'+','-'´¦Àí*****************/
 522   1             else if((press_date=='+')||(press_date=='-'))
 523   1             {
 524   2                            if(count==0)      // ±íÊ¾ÊäÈëÊı¾İµÄ·ûºÅ£¬´ËÊ±Ä¬ÈÏÊıÖµÎª0
 525   2                    {
 526   3                      write_date(press_date);
 527   3                      bdate[count_num][0]=press_date;
 528   3                                      bdate[count_num][1]='0';
 529   3                                      read_date();                    //¶Á×´Ì¬
 530   3                          write_date('0');
 531   3                          write_com(state);//¹â±ê»¹»ØÔ­À´Î»ÖÃ
 532   3                      count=1;
 533   3                    }
 534   2                    else                         
 535   2                    {
 536   3                                  cullars(press_date);//ÎªÔËËã·ûºÅ
 537   3                    }
 538   2             }
 539   1             /****************'*','/'´¦Àí*****************/
 540   1             else if(press_date==0xfd) //0xfd³ıºÅÔÚ1602Òº¾§ÖĞµÄ´úÂë
 541   1             {
 542   2                     if(sc==1)           //·ù¶È to ½Ç¶È
 543   2                         {  if(count!=0)
C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 10  

 544   3                            {futojiao[count_num]=1;sc=0;shift();write_date(0xDF);count=14;}
 545   3                                else {callerror();huifu();}
 546   3                         }
 547   2                 else cullars(press_date);
 548   2             }
 549   1                 else if(press_date=='*') //0xfd³ıºÅÔÚ1602Òº¾§ÖĞµÄ´úÂë
 550   1             {
 551   2                  cullars(press_date);
 552   2             }
 553   1             /*******************'='ºÅ´¦Àí*****************/
 554   1             else if(press_date=='=')
 555   1             {
 556   2                  write_com(0x01);           //ÇåÆÁ
 557   2                  write_com(0x80);
 558   2                  write_date(press_date);    //ÏÔÊ¾µÈºÅ
 559   2                          for(j=0;j<2;j++)               //Á½ÔËËã×éµÄº¯Êı´¦Àí
 560   2                              {
 561   3                                      date[j]=atof(bdate[j]);  //Á©×éÊı¾İ£¬×Ö·û´®->ÊµÊı
 562   3                                      if(pai[j][0]==1)
 563   3                                          {  date[j]=3.1415926535897932384626433832795;}
 564   3                                      if(pai[j][1]==1)
 565   3                                      {  date[j]=date[j]*3.1415926535897932384626433832795;}//¦ĞÇ°×º¼ÓÈ¨¼ÆËã
 566   3                                      if(ssym[j]=='-')
 567   3                                              {  date[j]=-date[j];   }          //Êı¾İÇ°·ûºÅ
 568   3                                      if(futojiao[j]==1)
 569   3                                          {   date[j]=date[j]*3.1415926535897932384626433832795/180;}  //·ù¶ÈÊÇ·ñ×ª½Ç¶È
 570   3                      if(bfun[j]!=0)                                    //ÊÇ·ñÓĞµ÷ÓÃº¯Êı£¬ÓĞÔòÏÈº¯ÊıÔËËã
 571   3                      {       switch(bfun[j])
 572   4                              {
 573   5                                                      case 's': date[j]=sin(date[j]);break;      //º¯Êısin
 574   5                                      case 'c': date[j]=cos(date[j]);break;      //º¯Êıcos
 575   5                                      case 't': date[j]=tan(date[j]);break;      //º¯Êıtan
 576   5                                                      case 'e': date[j]=exp(date[j]);break;      //º¯Êıexp
 577   5                                                      case 'l': date[j]=log(date[j]);break;      //º¯Êıln
 578   5                                                      case 'g': date[j]=log10(date[j]);break;    //º¯ÊıLg
 579   5                                                      case 'q': date[j]=sqrt(date[j]);break;     //º¯Êısqrt
 580   5                                                      case 'd': date[j]=1/date[j];break;                 //º¯Êıdao(µ¹Êı)
 581   5                              }
 582   4                      }
 583   3                                      if(fsym[j]=='-')date[j]=-date[j];        //º¯ÊıÇ°µÄ·ûºÅ´¦Àí
 584   3                              }
 585   2                              if(ferror==0)                                                    //½ö½öº¯Êı¼ÆËã
 586   2                                 {  resultdate=date[0];}
 587   2                  else                                                                         //ÔËËã·ûºÅ¼ÆËã
 588   2                              {
 589   3                                 switch(on_symbol)
 590   3                     {
 591   4                        case '+':resultdate=date[0]+date[1];break;
 592   4                        case '-':resultdate=date[0]-date[1];break;
 593   4                        case '*':resultdate=date[0]*date[1];break;
 594   4                        case 0xfd:resultdate=date[0]/date[1];break;       //0xfd³ıºÅÔÚ1602Òº¾§ÖĞµÄ´úÂë
 595   4                                        case '^':resultdate=pow(date[0],date[1]);break;       //pow()º¯Êı     x^y
 596   4                                        case '%':resultdate=fmod(date[0],date[1]);break;  //fmod()º¯Êı ÇóÓàÊı£¨Ë«¾«¶È£©
 597   4                     }
 598   3                              }
 599   2                  sprintf(jieguo,"%g",resultdate);//½á¹ûÊµÊı->×Ö·û´®,²ÉÓÃ¸ñÊ½×Ö·ûg,ÏµÍ³Ñ¡Ôñ%f»ò%eÊä³ö¸ñÊ½£¬ÁùÎ»Ó
             -ĞĞ§Êı×Ö
 600   2                      if((jieguo[0]>'9'||jieguo[0]<'0')&&(jieguo[1]>'9'||jieguo[1]<'0')&&jieguo[1]!='\0'&&jieguo[1]!='.
             -')
 601   2                               {   callerror();fuwei();return;  }      //´íÎó´¦Àí£¬µ±×é1»ò×é2²»ºÏ·¨Ê±½á¹ûÊÇ¼¸¸öÓ¢ÎÄ×ÖÄ¸ÌáÊ¾
 602   2                              else strcpy(result,jieguo);   //Ã»´íÎó£¬±£´æ½á¹û£¬½á¹ûÁ¢´æ M+¼ü
 603   2                  for(j=0;jieguo[j]!='\0';j++)               //ÏÔÊ¾½á¹û
C51 COMPILER V9.01   _íÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷                                                      02/05/2015 21:30:26 PAGE 11  

 604   2                       write_date(jieguo[j]);
 605   2                              for(;j<15;j++)write_date(' ');   //ÈÃ¹â±ê³öÆÁÄ»
 606   2                              eqsign=1;                                                //°´µÈºÅ¼ü±êÖ¾ÖÃ1
 607   2                 }
 608   1                 /*******************¸´Î»*****************/
 609   1             else if(press_date==' ')
 610   1             {
 611   2                  fuwei();
 612   2             }
 613   1                 return;
 614   1      }
 615          /*********************Ö÷³ÌĞò**********************/
 616          void main()
 617          {    
 618   1            fuwei();          //¼ÆËãÆ÷³õÊ¼»¯
 619   1            init();       //ÏÔÊ¾³õÊ¼»¯
 620   1                form=1;               //ÏÔÊ¾·½Ê½³õÊ¼»¯
 621   1                proc=0;               //¼ÆËã¹¤³Ì´æ´¢³õÊ¼»¯
 622   1            write_com(0x80+0x10);                                             
 623   1            write_str("Name:Maxi");                   //¿ª»ú»­ÃæµÚÒ»ĞĞ
 624   1            write_com(0x80+0x50);                                     //Ö¸ÕëÉèÖÃ
 625   1            write_str("SN:201212268031");                     //¿ª»ú»­ÃæµÚ¶şĞĞ
 626   1            write();
 627   1            while(1)      
 628   1            {
 629   2                process_date(keyscan()); //¼ÆËãÆ÷
 630   2            }
 631   1      }
 632          /*********************end**********************/
 633          
*** WARNING C291 IN LINE 331 OF ÂíÎõ¿ÆÑ§ĞÍ¼ÆËãÆ÷.C: not every exit path returns a value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2971    ----
   CONSTANT SIZE    =    105    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       5
   IDATA SIZE       =    135       8
   BIT SIZE         =      5    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
